<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ESP32 Control</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Top Navigation Bar -->
  <header>
    <h1>Simon Says Game</h1>
  </header>

  <!-- Button Interface -->
  <div class="button-container">
    <button id="sierra" onclick="handleButtonClick('sierra')"><span>Sierra</span></button>
    <button id="martillo" onclick="handleButtonClick('martillo')"><span>Martillo</span></button>
    <button id="dollar" onclick="handleButtonClick('dollar')"><span>$</span></button>
    <button id="taladro" onclick="handleButtonClick('taladro')"><span>Taladro</span></button>
  </div>

  <script>
    let sequence = [];
    let playerSequence = [];
    const buttons = ['sierra', 'martillo', 'dollar', 'taladro'];

    function sendRequest(route) {
      fetch(`http://192.168.1.6:80/${route}`)
        .then(response => response.text())
        .then(data => console.log(data))
        .catch(error => console.error("Error:", error));
    }

    function toggleButton(buttonId, send=false) {
      const button = document.getElementById(buttonId);
      button.classList.add('active');
      if (send) {
        sendRequest(`led/${buttonId}`);
      }
      setTimeout(() => {
        button.classList.remove('active');
      }, 500); // Change back to normal after 500ms
    }

    function handleButtonClick(buttonId) {
      playerSequence.push(buttonId);
      toggleButton(buttonId, send=true);
      checkPlayerSequence();
    }

    function checkPlayerSequence() {
      for (let i = 0; i < playerSequence.length; i++) {
        if (playerSequence[i] !== sequence[i]) {
          window.location.href = '/lost.html';
          return;
        }
      }
      if (playerSequence.length === sequence.length) {
        playerSequence = [];
        addNewButtonToSequence();
      }
    }

    function addNewButtonToSequence() {
      const randomButton = buttons[Math.floor(Math.random() * buttons.length)];
      sequence.push(randomButton);
      setTimeout(playSequence, 1000); // Add delay before playing the sequence
    }

    function playSequence() {
      let delay = 0;
      sequence.forEach((buttonId, index) => {
        setTimeout(() => {
          toggleButton(buttonId);
        }, delay);
        delay += 1000; // 1 second delay between button presses
      });
    }

    function startGame() {
      sequence = [];
      playerSequence = [];
      setTimeout(addNewButtonToSequence, 1000); // Add delay before starting the game
    }

    document.addEventListener('DOMContentLoaded', (event) => {
      startGame();
    });

    document.addEventListener('keydown', (event) => {
      switch(event.key) {
        case 'w':
          handleButtonClick('sierra');
          break;
        case 'a':
          handleButtonClick('dollar');
          break;
        case 's':
          handleButtonClick('taladro');
          break;
        case 'd':
          handleButtonClick('martillo');
          break;
      }
    });
  </script>
</body>
</html>